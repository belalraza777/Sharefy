/* Unified Story Feature Styles (Circles, Create, Viewer) */
@layer components {
  /* Story Bar */
  .story-bar-wrapper { width:100%; padding: var(--space-sm) var(--space-md); box-sizing:border-box; }
  .story-bar { display:flex; gap: var(--space-md); overflow-x:auto; scrollbar-width:none; padding:4px 2px; }
  .story-bar:focus-visible { outline:2px solid var(--primary); outline-offset:4px; }
  .story-bar::-webkit-scrollbar { display:none; }

  .story-circle { flex:0 0 auto; display:flex; flex-direction:column; align-items:center; cursor:pointer; width:70px; transition:transform .18s ease, filter .18s ease; }
  .story-circle:hover { transform:translateY(-3px); }
  .story-circle:active { transform:translateY(-1px); }
  /* Instagram-like rings */
  .story-avatar-wrap { width:64px; height:64px; padding:3px; border-radius: var(--radius-full); display:inline-flex; align-items:center; justify-content:center; box-shadow: 0 1px 2px rgba(0,0,0,0.06); transition: transform .18s ease; }
  .story-circle .story-avatar { width:58px; height:58px; object-fit:cover; border-radius:var(--radius-full); border:2px solid var(--white); display:block; background: var(--white); }
  .story-circle:hover .story-avatar-wrap { transform: translateY(-2px); }
  /* Unviewed: theme gradient ring (fallback to linear) */
  .story-circle.unviewed .story-avatar-wrap { background: var(--primary-gradient); background: conic-gradient(from 0deg, var(--primary) 0 120deg, var(--primary-light) 120deg 240deg, var(--primary) 240deg 360deg); }
  /* Viewed: neutral gray ring */
  .story-circle.viewed .story-avatar-wrap { background: var(--light-gray); filter:saturate(.9); }
  .story-username { margin-top:4px; font-size:11px; max-width:100%; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; color: var(--dark); font-weight: var(--font-weight-medium); }

  /* Add Story Circle */
  .story-circle.add .add-inner { display:flex; align-items:center; justify-content:center; width:58px; height:58px; border-radius:var(--radius-full); background:var(--primary-gradient); color:#fff; font-size:26px; font-weight: var(--font-weight-bold); box-shadow: var(--shadow-primary); position:relative; }
  .story-circle.add .add-inner::after { content:''; position:absolute; inset:0; border-radius:inherit; box-shadow:0 0 0 0 rgba(108,92,231,.4); animation:addPulse 2.4s ease-out infinite; }
  @keyframes addPulse { 0% { box-shadow:0 0 0 0 rgba(108,92,231,.45); } 70% { box-shadow:0 0 0 14px rgba(108,92,231,0); } 100% { box-shadow:0 0 0 0 rgba(108,92,231,0); } }
  .story-circle.add .add-inner:hover { filter:brightness(.95); }

  /* Skeleton Placeholders */
  .story-circle.skeleton { animation:pulse 1.3s ease-in-out infinite; }
  .story-circle.skeleton .skeleton-inner { width:58px; height:58px; border-radius:var(--radius-full); background:#ece8ff; }
  .story-circle.skeleton .skeleton-text { width:40px; height:10px; background:#ece8ff; border-radius:4px; margin-top:4px; }
  @keyframes pulse { 0% { opacity:.6; } 50% { opacity:1; } 100% { opacity:.6; } }

  .story-error { display:flex; align-items:center; gap:var(--space-sm); margin-bottom:6px; font-size:12px; color: var(--danger); }
  .story-error button { background: var(--danger); color:#fff; border:none; padding:4px 10px; border-radius:var(--radius-sm); cursor:pointer; font-size:11px; letter-spacing:.3px; }
  .story-error button:hover { background: var(--danger-light); }

  /* Create Story Modal/Form */
  /* Create Story Overlay */
  /* Centered Create Story Overlay */
  .story-create-overlay { position:fixed; inset:0; background:radial-gradient(circle at 30% 20%, rgba(255,255,255,.35), rgba(0,0,0,.65)); backdrop-filter: blur(6px) saturate(130%); display:flex; align-items:flex-start; justify-content:center; padding:16px 16px 64px; z-index: var(--z-modal); animation: fadeIn .35s ease; overflow-y:auto; }
  .story-create-modal { width:100%; max-width:420px; animation: scaleIn .35s ease; max-height:calc(100vh - 180px); display:flex; flex-direction:column; padding: 32px; margin-top: clamp(72px, 12vh, 140px) !important; }
  .story-create-modal > .create-story-container { padding: 24px 24px 18px !important; }
  .create-story-container { flex:1; overflow-y:auto; }
  .create-story-container::-webkit-scrollbar { width:8px; }
  .create-story-container::-webkit-scrollbar-track { background:rgba(255,255,255,0.3); border-radius:8px; }
  .create-story-container::-webkit-scrollbar-thumb { background:rgba(108,92,231,0.45); border-radius:8px; }
  .create-story-container::-webkit-scrollbar-thumb:hover { background:rgba(108,92,231,0.6); }
  @keyframes scaleIn { 0% { transform:translateY(12px) scale(.96); opacity:0; } 100% { transform:translateY(0) scale(1); opacity:1; } }
  .create-story-container { padding: var(--space-xl, 24px); width:100%; background: var(--card-bg); border:1px solid var(--border-color); border-radius: var(--radius-xl); box-shadow: var(--shadow-lg); animation: fadeIn .35s ease; }
  .create-story-form { display:flex; flex-direction:column; gap: var(--space-lg); padding: var(--space-md) var(--space-lg) 0; }
  @media (max-width:700px) {
    .story-create-overlay { padding:72px 12px 56px; }
    .story-create-modal { max-height:calc(100vh - 128px); padding: 24px; margin-top:16px; }
    .create-story-form { padding: var(--space-sm) var(--space-md) 0; gap: var(--space-md); }
  }
  .create-story-form h3 { margin:0; font-size:1.15rem; font-weight: var(--font-weight-semibold); color: var(--dark); letter-spacing:.5px; }
  .file-picker { display:flex; flex-direction:column; gap:6px; cursor:pointer; font-size:13px; }
  .file-picker input { display:none; }
  .file-picker span { padding:10px 12px; background:#f5f1ff; color: var(--primary-dark); border-radius: var(--radius-lg); text-align:center; font-weight: var(--font-weight-medium); box-shadow: var(--shadow-sm); border:2px solid rgba(108,92,231,0.18); transition: all var(--transition-fast); }
  .file-picker span:hover { background:#e3d6ff; border-color: var(--primary); }
  .preview-wrapper { width:100%; border:2px solid var(--primary-light); border-radius: var(--radius-lg); overflow:hidden; background: var(--surface); box-shadow: var(--shadow-md); position:relative; display:flex; align-items:center; justify-content:center; min-height:220px; }
  .preview-wrapper::after { content:''; position:absolute; inset:0; pointer-events:none; background:linear-gradient(145deg,rgba(255,255,255,0) 40%,rgba(108,92,231,.08)); }
  .preview-media { max-height:60vh; width:auto; height:auto; display:block; object-fit:contain; }
  .caption-input { min-height:90px; resize:vertical; background: var(--white); color: var(--dark); border:2px solid var(--light-gray); border-radius: var(--radius-lg); padding:10px 12px; font-size:14px; font-family: inherit; line-height:1.5; }
  .caption-input:focus { outline:none; border-color: var(--primary); box-shadow:0 0 0 3px rgba(108,92,231,0.15); }
  .caption-input:disabled { opacity:.6; }
  .story-create-error { color: var(--danger); font-size:12px; }
  .actions-row { display:flex; gap: var(--space-sm); justify-content:flex-end; margin-top: var(--space-sm); }
  .btn.primary { background: var(--primary-gradient); color:#fff; border:none; }
  .btn.primary:hover { filter:brightness(.95); box-shadow: var(--shadow-primary-hover); }
  .btn.secondary { background:#f5f1ff; color: var(--primary-dark); border:1px solid rgba(108,92,231,0.25); }
  .btn.secondary:hover { background:#e3d6ff; border-color: var(--primary); }
  .btn:active { transform: translateY(1px); }

  /* Viewer Overlay */
  .story-viewer-overlay { position:fixed; inset:0; background:radial-gradient(circle at 30% 20%, rgba(255,255,255,.15), rgba(0,0,0,.65)); display:flex; align-items:center; justify-content:center; z-index: var(--z-modal); backdrop-filter: blur(4px); animation: fadeIn .4s ease; }
  .story-viewer { width:min(880px,95%); max-height:90vh; background: var(--white); border-radius: var(--radius-xl); display:flex; flex-direction:column; padding: calc(var(--space-xl) + 0.75rem) calc(var(--space-xl) + 2rem); box-sizing:border-box; box-shadow: var(--shadow-xl); position:relative; animation: slideUp .45s ease; gap: var(--space-md); }
  .story-viewer-header { display:flex; align-items:center; justify-content:space-between; padding-bottom:6px; border-bottom:1px solid rgba(108,92,231,0.12); }
  .story-user { display:flex; align-items:center; gap: var(--space-sm); }
  .story-user img { width:48px; height:48px; border-radius:var(--radius-full); object-fit:cover; border:3px solid var(--white); box-shadow: var(--shadow-sm); background: var(--primary-gradient); }
  .story-username-viewer { font-weight: var(--font-weight-semibold); font-size:14px; letter-spacing:.4px; color: var(--dark); }
  .story-header-right { display:flex; align-items:center; gap: var(--space-sm); }
  .story-views-pill { background:linear-gradient(135deg, rgba(108,92,231,0.12), rgba(162,155,254,0.22)); color: var(--primary-dark); padding:6px 14px; border-radius:999px; font-size:13px; font-weight: var(--font-weight-semibold); line-height:1; display:inline-flex; align-items:center; gap:6px; box-shadow:0 3px 6px rgba(0,0,0,0.08); border:1px solid rgba(108,92,231,0.28); }
  .story-views-pill svg { width:20px; height:20px; stroke-width:2.2; }
  .story-actions { display:flex; align-items:center; gap: var(--space-sm); }
  .story-actions .btn { padding:6px 14px; font-size:13px; border-radius: var(--radius-lg); background:#f5f1ff; color: var(--primary-dark); border:1px solid rgba(108,92,231,0.25); }
  .story-actions .btn:hover { background:#e3d6ff; }
  .story-actions .btn.danger { background: red; color:#fff; border:none; }
  .story-actions .btn.danger:hover { background: var(--danger-light); }
  .story-actions .btn.close { background: var(--white); color: var(--dark-light); }
  .story-actions .btn.close:hover { background:#faf8ff; color: var(--dark); }
  .story-media-wrapper { flex:1; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; padding: var(--space-md); background:linear-gradient(145deg, rgba(255,255,255,0.65), rgba(255,255,255,0.4)); border:1px solid rgba(108,92,231,0.08); border-radius: var(--radius-xl); }
  .story-media-wrapper img, .story-media-wrapper video { max-width:100%; max-height:calc(100vh - 300px); width:auto; height:auto; object-fit:contain; border-radius: var(--radius-lg); box-shadow: var(--shadow-lg); }
  @media (max-width:700px) { .story-media-wrapper img, .story-media-wrapper video { max-height:55vh; } }
  .nav-buttons .nav { pointer-events:auto; background:linear-gradient(135deg, rgba(255,255,255,0.85), rgba(255,255,255,0.65)); border:1px solid rgba(108,92,231,0.25); color: var(--primary-dark); width:46px; height:46px; border-radius: var(--radius-full); font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; backdrop-filter: blur(4px); transition: background .25s, transform .25s, color .25s; box-shadow: var(--shadow-md); }
  .nav-buttons .nav:hover { background: var(--primary-gradient); color:#fff; transform:translateY(-3px); }
  .nav-buttons .nav:disabled { opacity:0.4; cursor:not-allowed; }
  .story-viewer-header { display:flex; align-items:center; justify-content:space-between; margin-bottom: var(--space-md); }
  .story-user { display:flex; align-items:center; gap: var(--space-md); font-size:15px; font-weight: var(--font-weight-medium); letter-spacing:.3px; }
  .story-user img { width:54px; height:54px; border-radius: var(--radius-full); object-fit:cover; box-shadow: var(--shadow-sm); border:3px solid var(--white); background: var(--primary-gradient); }
  .story-actions { display:flex; gap: var(--space-sm); }
  .story-actions .btn { padding:6px 12px; font-size:12px; }
  .story-actions .btn.danger { background: var(--danger); color:#fff; }
  .story-actions .btn.danger:hover { background: var(--danger-light); }
  .story-media-wrapper { flex:1; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative; }
  /* Ensure tall media fits inside viewport without overflow */
  .story-media-wrapper img, .story-media-wrapper video { max-width:100%; max-height:calc(100vh - 220px); width:auto; height:auto; object-fit:contain; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); }
  @media (max-width:700px) { .story-media-wrapper img, .story-media-wrapper video { max-height:55vh; } }
  @media (max-width:640px) {
    .story-create-overlay { padding:12px 12px 48px; }
    .story-create-modal { margin-top: 64px !important; max-height: calc(100vh - 140px); padding: 24px; }
    .story-create-modal > .create-story-container { padding: 20px 20px 16px !important; }
  }
  .story-caption-overlay { position:absolute; left: var(--space-md); right: var(--space-md); bottom: var(--space-md); background: linear-gradient(135deg, rgba(255,255,255,0.92), rgba(248,245,255,0.95)); border-radius: var(--radius-lg); padding: var(--space-sm) var(--space-md); box-shadow: var(--shadow-md); backdrop-filter: blur(4px); animation: fadeIn .35s ease; }
  .story-caption-overlay p { margin:0; font-size:0.95rem; line-height:1.4; color: var(--dark); font-weight: var(--font-weight-medium); }
  .story-footer { display:flex; align-items:center; justify-content:space-between; margin-top: var(--space-md); font-size:13px; }
  .story-caption { margin:0; color: var(--dark-light); font-size:0.92rem; line-height:1.35; }
  .story-views { color: var(--primary-dark); font-weight: var(--font-weight-semibold); letter-spacing:.4px; }
  .nav-buttons { position:absolute; top:50%; left:0; right:0; display:flex; justify-content:space-between; pointer-events:none; padding:0 var(--space-md); }
  .nav-buttons .nav { pointer-events:auto; background:rgba(108,92,231,0.25); border:none; color:#fff; width:46px; height:46px; border-radius: var(--radius-full); font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; backdrop-filter: blur(4px); transition: background .2s, transform .2s; }
  .nav-buttons .nav:hover { background:rgba(108,92,231,0.45); transform:translateY(-2px); }
  .nav-buttons .nav:hover { background:rgba(108,92,231,0.4); }
  .nav-buttons .nav:disabled { opacity:0.4; cursor:not-allowed; }
  @media (max-width:700px) { .story-media-wrapper img, .story-media-wrapper video { max-height:55vh; } }
}